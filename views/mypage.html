{% extends 'layout.html' %}

{% block content %}

    <div class="mypage-main">
        <div class="pick-text" id="mypick">MY PICK!</div>
        <div class="pick-text-sub">자신의 음식 취향을 알려주세요</div>
        <div class="form-myfoodSelect"> 
            <div class="food-form" id="koreanfood-form"> 
                <div class="food-info"> <div class ="food-info-text" id="koreanfood-info">한식</div>
                    <div class="food-info-set">
                        {% if foodSelectlist %}
                            {% if (user.id == foodSelectlist.user) and (user.id in foodSelectlist[0].userlike) %}
                                <a id="form-modify" href="/form/update/1" class="btn">수정하기</a>
                                <button id="form-remove" onClick='removeSelect({{foodSelectlist.user}}, {{user.id}}, 1)' class="btn">삭제하기</button>
                            {% else %}
                                <a id="form" href="/form/1" class="btn">선택하기</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                {% for foodSelect in foodSelectlist %}
                    {% if foodSelect and foodSelect.id and foodSelect.categorynumber == 1 %}
                        <div class="food-name-raw">
                            {{loop.index}}  
                            {{foodSelect.name}}
                            {% if (user.id).toString() in foodSelect.userlike %}
                                {% if foodSelect.userlike[user.id] == 1 %}
                                    <div class="islike">
                                        호
                                    </div>
                                {% else %}
                                    <div class="isdislike">
                                        불호
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="food-form" id="chinesefood-form"> 
                <div class="food-info"><div  class ="food-info-text" id="chinesefood-info">중식</div>
                    <div class="food-info-set">
                        {% if foodSelectlist %}
                            {% if (user.id == foodSelectlist.user) and (user.id in foodSelectlist[40].userlike) %}
                                <a id="form-modify" href="/form/update/2" class="btn">수정하기</a>
                                <button id="form-remove" onClick='removeSelect({{foodSelectlist.user}}, {{user.id}}, 2)' class="btn">삭제하기</button>
                            {% else %}
                                <a id="form" href="/form/2" class="btn">선택하기</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                {% for foodSelect in foodSelectlist %}
                    {% if foodSelect and foodSelect.id and foodSelect.categorynumber == 2 %}
                        <div class="food-name-raw">
                            {{loop.index}}  
                            {{foodSelect.name}}
                            {% if (user.id).toString() in foodSelect.userlike %}
                                {% if foodSelect.userlike[user.id] == 1 %}
                                    <div class="islike">
                                        호
                                    </div>
                                {% else %}
                                    <div class="isdislike">
                                        불호
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="food-form" id="japanesefood-form"> 
                <div class="food-info"> <div  class ="food-info-text" id="japanesefood-info">일식</div>
                    <div class="food-info-set">
                        {% if foodSelectlist %}
                            {% if (user.id == foodSelectlist.user) and (user.id in foodSelectlist[60].userlike) %}
                                <a id="form-modify" href="/form/update/3" class="btn">수정하기</a>
                                <button id="form-remove" onClick='removeSelect({{foodSelectlist.user}}, {{user.id}}, 3)' class="btn">삭제하기</button>
                            {% else %}
                                <a id="form" href="/form/3" class="btn">선택하기</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                {% for foodSelect in foodSelectlist %}
                    {% if foodSelect and foodSelect.id and foodSelect.categorynumber == 3 %}
                        <div class="food-name-raw">
                            {{loop.index}}  
                            {{foodSelect.name}}
                            {% if (user.id).toString() in foodSelect.userlike %}
                                {% if foodSelect.userlike[user.id] == 1 %}
                                    <div class="islike">
                                        호
                                    </div>
                                {% else %}
                                    <div class="isdislike">
                                        불호
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="food-form" id="westernfood-form"> 
                <div class="food-info">  <div  class ="food-info-text" id="westernfood-info">양식</div>
                    <div class="food-info-set">
                        {% if foodSelectlist %}
                            {% if (user.id == foodSelectlist.user) and (user.id in foodSelectlist[80].userlike) %}
                                <a id="form-modify" href="/form/update/4" class="btn">수정하기</a>
                                <button id="form-remove" onClick='removeSelect({{foodSelectlist.user}}, {{user.id}}, 4)' class="btn">삭제하기</button>
                            {% else %}
                                <a id="form" href="/form/4" class="btn">선택하기</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                {% for foodSelect in foodSelectlist %}
                    {% if foodSelect and foodSelect.id and foodSelect.categorynumber == 4 %}
                        <div class="food-name-raw">
                            {{loop.index}}  
                            {{foodSelect.name}}
                            {% if (user.id).toString() in foodSelect.userlike %}
                                {% if foodSelect.userlike[user.id] == 1 %}
                                    <div class="islike">
                                        호
                                    </div>
                                {% else %}
                                    <div class="isdislike">
                                        불호
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="food-form" id="likedislike-form">
                <div class="food-info"> <div  class ="food-info-text" id="likedislike-info">호불호</div>
                    <div class="food-info-set">
                        {% if foodSelectlist %}
                            {# {% if (user.id).toString() in foodSelectlist[100].userlike %}
                                {% if user.id == foodSelectlist.user %}
                                    <a id="form-modify" href="/form/update/5" class="btn">수정하기</a>
                                    <button id="form-remove" onClick='removeSelect({{foodSelectlist.user}}, {{user.id}}, 5)' class="btn">삭제하기</button>               
                                {% endif %}
                            {% else %}
                                <a id="form" href="/form/5" class="btn">선택하기</a>
                            {% endif %} #}

                            {% if (user.id == foodSelectlist.user) and (user.id in foodSelectlist[100].userlike) %}
                                <a id="form-modify" href="/form/update/5" class="btn">수정하기</a>
                                <button id="form-remove" onClick='removeSelect({{foodSelectlist.user}}, {{user.id}}, 5)' class="btn">삭제하기</button>
                            {% else %}
                                <a id="form" href="/form/5" class="btn">선택하기</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                {% for foodSelect in foodSelectlist %}
                    {% if foodSelect and foodSelect.id and foodSelect.categorynumber == 5 %}
                        <div class="food-name-raw">
                            {{loop.index}}  
                            {{foodSelect.name}}
                            {% if (user.id).toString() in foodSelect.userlike %}
                                {% if foodSelect.userlike[user.id] == 1 %}
                                    <div class="islike">
                                        호
                                    </div>
                                {% else %}
                                    <div class="isdislike">
                                        불호
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    

    <div class="follower-list-div">
        <div class="pick-text" id="followingspick">FOLLOWINGS PICK!</div>
        <div class="pick-text-sub">팔로우 하는 사람들과의 음식 취향 일치율이 이 곳에 표시됩니다
            <br>"호" 또는 "불호"에 동일하게 체크한 경우 %가 증가합니다 
        </div>
        <a id="analyze-button" href="/analyze" class="btn">친구야 밥 먹자</a>
            <table class="follower-list">
                <thead>
                    <tr id="following-category-head">
                        <th id="following-category-id">닉네임</th>
                        <th id="following-category-korean">한식</th>
                        <th id="following-category-chinese">중식</th>
                        <th id="following-category-japanese">일식</th>
                        <th id="following-category-western">양식</th>
                        <th id="following-category-likedislike">호불호</th>
                        <th id="following-category-sum">전체</th>
                    </tr>
                </thead>
                <tbody>
                    {% if user.Followings %} 
                        {% for following in user.Followings %} 
                            <tr class="following-percent-div">
                                <th id="following-info">
                                    <div id="followingnick">
                                        {{following.nick}}
                                    </div>    
                                    <div id="followingid">
                                        ({{following.localId}})
                                    </div>    
                                </th>    
                                {% for percent in percentlist %}
                                    {% if percent.id==following.id %}
                                        {% if ('1' in percent.categorypercent) %}
                                            <td class="following-percent-text">
                                                {{ percent.categorypercent['1'] }}%
                                            </td>    
                                        {% endif %}
                                        {% if ('2' in percent.categorypercent) %}
                                            <td class="following-percent-text">
                                                {{ percent.categorypercent['2'] }}%      
                                            </td>    
                                        {% endif %}
                                        {% if ('3' in percent.categorypercent) %}
                                            <td class="following-percent-text">
                                                {{ percent.categorypercent['3'] }}%
                                            </td>    
                                        {% endif %}
                                        {% if ('4' in percent.categorypercent) %}
                                            <td class="following-percent-text">
                                                {{ percent.categorypercent['4'] }}%
                                            </td>   
                                        {% endif %}
                                        {% if ('5' in percent.categorypercent) %}
                                            <td class="following-percent-text">
                                                {{ percent.categorypercent['5'] }}%
                                            </td>   
                                        {% endif %}
                                        {% if percent.sumpercent or percent.sumpercent > -1 %}
                                        
                                            <td class="following-percent-text" id="following-percent-text-sum">
                                                {{ percent.sumpercent }}%
                                                <div class="following-percent-more"> 
                                                <a class="btn" id="show" href="/member/{{percent.localId}}">더보기</a>
                                                </div>
                                            </td>    
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </tr>    
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>
    </div>
{% endblock %}


{% block script %}
    <script>


        async function removeSelect(selectUserid, userid, category){
           await axios.post(`/form/remove`,{
               selectUserid,
               userid,
               category,
           }).then((res)=>{
               if(res.data.status==="true"){
                   location.reload();
               }
               else if(res.data.status==="not equal user"){
                   alert(selectUserid+"님의 정보가 아닙니다!");
               }
           })
       };

       async function more(followingid){
            await axios.get(`/${followingid}`,{
                followingid,
           }).then((res)=>{
               if(res.data.status==="true"){
                   location.reload();
               }
               else if(res.data.status==="not equal user"){
                   alert(selectUserid+"님의 정보가 아닙니다!");
               }
           })
       };

 
    </script>
{% endblock %}    